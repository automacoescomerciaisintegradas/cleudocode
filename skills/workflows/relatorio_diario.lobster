name: "Relat√≥rio de Atividades Di√°rio"
description: "Gera relat√≥rio consolidado das atividades do dia"
version: "1.0"
author: "Cleudocode Team"

variables:
  report_date: "{{ date }}"

steps:
  - name: "Coletar logs do sistema"
    skill: "shell"
    action: "execute"
    params:
      command: "type logs\\cleudocode.log | find \"{{ date }}\""
    continue_on_error: true
    
  - name: "Contar mensagens processadas"
    skill: "shell"
    action: "execute"
    params:
      command: "type logs\\audit.jsonl | find \"{{ date }}\" /c"
    continue_on_error: true
    
  - name: "Verificar erros do dia"
    skill: "shell"
    action: "execute"
    params:
      command: "type logs\\cleudocode.log | find \"{{ date }}\" | find \"ERROR\" /c"
    continue_on_error: true
    
  - name: "Listar workflows executados"
    skill: "shell"
    action: "execute"
    params:
      command: "type logs\\cleudocode.log | find \"Executando workflow\""
    continue_on_error: true
    
  - name: "Gerar relat√≥rio em Markdown"
    skill: "filesystem"
    action: "write_file"
    params:
      filepath: "reports/diario_{{ date }}.md"
      content: |
        # Relat√≥rio Di√°rio - {{ date }}
        
        ## üìä Resumo Executivo
        
        - **Data**: {{ datetime }}
        - **Mensagens Processadas**: {{ step_1_result.stdout }}
        - **Erros Registrados**: {{ step_2_result.stdout }}
        - **Status Geral**: {% if step_2_result.stdout == "0" %}‚úÖ Opera√ß√£o Normal{% else %}‚ö†Ô∏è Aten√ß√£o Necess√°ria{% endif %}
        
        ## üîÑ Workflows Executados
        
        ```
        {{ step_3_result.stdout }}
        ```
        
        ## üìù Logs do Sistema
        
        ```
        {{ step_0_result.stdout }}
        ```
        
        ## üìà Estat√≠sticas
        
        | M√©trica | Valor |
        |---------|-------|
        | Mensagens | {{ step_1_result.stdout }} |
        | Erros | {{ step_2_result.stdout }} |
        | Workflows | V√°rios |
        
        ## üéØ Pr√≥ximas A√ß√µes
        
        {% if step_2_result.stdout != "0" %}
        - [ ] Investigar erros registrados
        - [ ] Verificar logs detalhados
        - [ ] Aplicar corre√ß√µes necess√°rias
        {% else %}
        - [x] Sistema operando normalmente
        - [ ] Continuar monitoramento
        {% endif %}
        
        ---
        
        *Relat√≥rio gerado automaticamente pelo Lobster Workflow Engine*
      overwrite: true
    
  - name: "Criar vers√£o em texto"
    skill: "filesystem"
    action: "write_file"
    params:
      filepath: "reports/diario_{{ date }}.txt"
      content: |
        ===================================
        RELAT√ìRIO DI√ÅRIO - {{ date }}
        ===================================
        
        Data/Hora: {{ datetime }}
        
        RESUMO:
        - Mensagens: {{ step_1_result.stdout }}
        - Erros: {{ step_2_result.stdout }}
        
        WORKFLOWS EXECUTADOS:
        {{ step_3_result.stdout }}
        
        ===================================
      overwrite: true
    
  - name: "Enviar relat√≥rio por Telegram"
    skill: "telegram"
    action: "send_message"
    params:
      message: |
        üìä Relat√≥rio Di√°rio - {{ date }}
        
        üìà Mensagens: {{ step_1_result.stdout }}
        {% if step_2_result.stdout == "0" %}‚úÖ Sem erros{% else %}‚ö†Ô∏è Erros: {{ step_2_result.stdout }}{% endif %}
        
        üìÑ Relat√≥rios salvos:
        - reports/diario_{{ date }}.md
        - reports/diario_{{ date }}.txt
        
        {% if step_2_result.stdout != "0" %}‚ö†Ô∏è Aten√ß√£o: Erros detectados! Verifique os logs.{% endif %}
